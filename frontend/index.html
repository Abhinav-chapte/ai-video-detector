<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Video Detector Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .analysis-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stats-card, .history-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 50px 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 30px;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: rgba(102, 126, 234, 0.05);
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
        }

        .upload-text {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #666;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        input[type="file"] { display: none; }

        .video-preview {
            display: none;
            margin: 20px 0;
            text-align: center;
        }

        .video-preview video {
            width: 100%;
            max-width: 600px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .file-info {
            display: none;
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .file-info h3 {
            margin-bottom: 15px;
            color: #667eea;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 30px;
            font-size: 1.2rem;
            cursor: pointer;
            width: 100%;
            margin: 20px 0;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.6);
        }

        .analyze-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 30px 0;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            animation: progress 3s ease-in-out infinite;
        }

        @keyframes progress {
            0% { width: 10%; }
            50% { width: 80%; }
            100% { width: 95%; }
        }

        .results {
            display: none;
            background: #f8f9ff;
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border: 2px solid #e9ecef;
        }

        .result-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .verdict-display {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 20px;
            border-radius: 15px;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .confidence-display {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .probability-bars {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .probability-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .probability-label {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .probability-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .probability-fill {
            height: 100%;
            border-radius: 15px;
            transition: width 1s ease;
            position: relative;
        }

        .ai-generated { background: linear-gradient(90deg, #dc3545, #c82333); }
        .human-made { background: linear-gradient(90deg, #28a745, #218838); }

        .probability-text {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .performance-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .perf-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .perf-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .perf-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #667eea;
        }

        .stats-card h3, .history-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-value {
            font-weight: bold;
            color: #667eea;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: #f0f2ff;
            transform: translateX(5px);
        }

        .history-filename {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .history-details {
            font-size: 0.9rem;
            color: #666;
            display: flex;
            justify-content: space-between;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .tab-container {
            margin: 20px 0;
        }

        .tab-buttons {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .component-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .component-name {
            font-weight: bold;
        }

        .component-value {
            font-weight: bold;
            color: #667eea;
        }
        .component-scores {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.component-card {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.component-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.component-title {
    font-size: 0.9rem;
    font-weight: bold;
    margin-bottom: 8px;
    color: #00d4ff;
    display: flex;
    align-items: center;
    gap: 5px;
}

.component-score {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.component-description {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.4;
}

.analysis-details {
    margin-top: 20px;
    padding: 20px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.detail-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    padding: 5px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.detail-label {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
}

.detail-value {
    color: #00d4ff;
    font-weight: bold;
}

.advanced-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.metric-item {
    text-align: center;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.metric-value {
    font-size: 1.2rem;
    font-weight: bold;
    color: #00d4ff;
    margin-bottom: 5px;
}

.metric-label {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.8);
}

.confidence-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    overflow: hidden;
    margin: 8px 0;
}

.confidence-fill {
    height: 100%;
    background: linear-gradient(90deg, #ff6b6b 0%, #ffd93d 50%, #6bcf7f 100%);
    border-radius: 4px;
    transition: width 0.8s ease;
}

.analysis-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: bold;
    margin-right: 5px;
    margin-bottom: 5px;
}

.badge-active {
    background: #00d4ff;
    color: #000;
}

.badge-inactive {
    background: rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.7);
}

@keyframes pulse-glow {
    0% { box-shadow: 0 0 5px rgba(0, 212, 255, 0.5); }
    50% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.8); }
    100% { box-shadow: 0 0 5px rgba(0, 212, 255, 0.5); }
}

.analyzing-glow {
    animation: pulse-glow 2s infinite;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI Video Detector Pro</h1>
            <p>Advanced AI-powered video analysis with deep learning detection</p>
        </div>

        <div class="main-content">
            <div class="analysis-panel">
                <div class="upload-area" id="uploadArea">
                    <span class="upload-icon">🎥</span>
                    <div class="upload-text">Drag & drop your video here or click to browse</div>
<div style="font-size: 0.9rem; color: #888; margin-top: 10px;">
    Supports: MP4, AVI, MOV, WMV, FLV, WebM • Max size: 100MB
</div>
            <button class="upload-btn">Choose Video File</button>
                    <input type="file" id="fileInput" accept="video/*">
                </div>

                <div class="file-info" id="fileInfo">
                    <h3>📄 File Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span>Filename:</span>
                            <span id="fileName">-</span>
                        </div>
                        <div class="info-item">
                            <span>Size:</span>
                            <span id="fileSize">-</span>
                        </div>
                        <div class="info-item">
                            <span>Duration:</span>
                            <span id="fileDuration">-</span>
                        </div>
                        <div class="info-item">
                            <span>Resolution:</span>
                            <span id="fileResolution">-</span>
                        </div>
                    </div>
                </div>

                <div class="video-preview" id="videoPreview">
                    <video controls id="videoPlayer"></video>
                </div>

                <button class="analyze-btn" id="analyzeBtn" onclick="analyzeVideo()" disabled>
                    🔍 Analyze Video for AI Detection
                </button>

                <div class="loading" id="loadingDiv">
                    <div class="spinner"></div>
                    <div class="loading-text">Analyzing video with advanced AI algorithms...</div>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div style="font-size: 0.9rem; color: #999;">This may take 1-3 minutes depending on video length</div>
                </div>
                <div id="result"></div>

                <div class="results" id="results">
                    <div class="result-header">
                        <div class="verdict-display" id="verdictDisplay">Analyzing...</div>
                        
                        <div class="confidence-display" id="confidenceDisplay">Processing...</div>
                    </div>

                    <div class="probability-bars">
                        <div class="probability-item">
                            <div class="probability-label">🤖 AI Generated</div>
                            <div class="probability-bar">
                                <div class="probability-fill ai-generated" id="aiBar" style="width: 0%"></div>
                            </div>
                            <div class="probability-text" id="aiPercentage">0%</div>
                        </div>
                        <div class="probability-item">
                            <div class="probability-label">👤 Human Made</div>
                            <div class="probability-bar">
                                <div class="probability-fill human-made" id="humanBar" style="width: 0%"></div>
                            </div>
                            <div class="probability-text" id="humanPercentage">0%</div>
                        </div>
                    </div>

                    <div class="performance-info" id="performanceInfo">
                        <div class="perf-item">
                            <div class="perf-label">Analysis Time</div>
                            <div class="perf-value" id="analysisTime">-</div>
                        </div>
                        <div class="perf-item">
                            <div class="perf-label">Analysis Type</div>
                            <div class="perf-value" id="analysisType">-</div>
                        </div>
                        <div class="perf-item">
                            <div class="perf-label">Database ID</div>
                            <div class="perf-value" id="databaseId">-</div>
                        </div>
                        <div class="perf-item">
                            <div class="perf-label">GPU Acceleration</div>
                            <div class="perf-value" id="gpuStatus">-</div>
                        </div>
                    </div>

                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button class="tab-btn active" onclick="showTab('overview')">Overview</button>
                            <button class="tab-btn" onclick="showTab('detailed')" id="detailedTab">Detailed Analysis</button>
                        </div>

                        <div class="tab-content active" id="overviewTab">
                            <h4>📊 Analysis Overview</h4>
                            <div id="overviewContent">
                                <p>Complete analysis details will appear here after video processing.</p>
                            </div>
                        </div>

                        <div class="tab-content" id="detailedTab">
                            <h4>🔬 Component Analysis</h4>
                            <div id="componentScores">
                                <p>Detailed component analysis will appear here for advanced detection.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="stats-card">
                    <h3>📈 System Statistics <button class="refresh-btn" onclick="loadStats()">↻</button></h3>
                    <div id="statsContent">
                        <div class="stat-item">
                            <span>Total Videos Analyzed</span>
                            <span class="stat-value" id="totalVideos">-</span>
                        </div>
                        <div class="stat-item">
                            <span>AI Generated Detected</span>
                            <span class="stat-value" id="aiDetected">-</span>
                        </div>
                        <div class="stat-item">
                            <span>Human Made Detected</span>
                            <span class="stat-value" id="humanDetected">-</span>
                        </div>
                        <div class="stat-item">
                            <span>Average Processing Time</span>
                            <span class="stat-value" id="avgTime">-</span>
                        </div>
                    </div>
                </div>

                <div class="history-card">
                    <h3>📝 Recent Analysis <button class="refresh-btn" onclick="loadHistory()">↻</button></h3>
                    <div class="history-list" id="historyList">
                        <p style="text-align: center; color: #666; margin: 20px 0;">No analysis history yet. Upload a video to get started!</p>
                    </div>
                </div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 40px; padding: 20px; color: rgba(255,255,255,0.8);">
    <p style="margin-bottom: 10px;">
        🔬 <strong>AI Video Detector Pro</strong> • Advanced deepfake and AI-generated content detection
    </p>
    <p style="font-size: 0.9rem; opacity: 0.7;">
        Powered by TensorFlow, OpenCV & Advanced Computer Vision • 
        <strong>Keyboard Shortcuts:</strong> Ctrl+U (Upload), Ctrl+Enter (Analyze), Ctrl+F5 (Refresh)
    </p>
</div>
    </div>

    <script>
        let selectedFile = null;
        let currentAnalysisId = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupUploadHandlers();
            loadStats();
            loadHistory();
        });

       function setupUploadHandlers() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');

    // Remove the inline onclick from the upload button first
    const uploadBtn = uploadArea.querySelector('.upload-btn');
    uploadBtn.removeAttribute('onclick');

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, unhighlight, false);
    });

    // Handle dropped files
    uploadArea.addEventListener('drop', handleDrop, false);

    // Handle click events - be more specific
    uploadBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        fileInput.click();
    });

    // Handle file input change
    fileInput.addEventListener('change', (e) => {
        if (e.target.files && e.target.files[0]) {
            handleFileSelect(e.target.files[0]);
        }
        // Clear the input to allow selecting the same file again
        e.target.value = '';
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function highlight() {
        uploadArea.classList.add('dragover');
    }

    function unhighlight() {
        uploadArea.classList.remove('dragover');
    }

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files && files[0] && files[0].type.startsWith('video/')) {
            handleFileSelect(files[0]);
        } else {
            alert('Please select a video file');
        }
    }
}

       function handleFileSelect(file) {
    // Clear previous file if any
    selectedFile = null;
    document.getElementById('analyzeBtn').disabled = true;
    
    // Validate file
    if (!file || !file.type.startsWith('video/')) {
        alert('Please select a valid video file');
        return;
    }
    
    if (file.size > 100 * 1024 * 1024) { // 100MB limit
        alert('File too large. Maximum size is 100MB');
        return;
    }
    
    console.log('File selected:', file.name, file.size);
    
    // Set the selected file
    selectedFile = file;
    
    // Update file info immediately
    document.getElementById('fileName').textContent = file.name;
    document.getElementById('fileSize').textContent = formatFileSize(file.size);
    document.getElementById('fileInfo').style.display = 'block';
    
    // Clean up previous video URL if any
    const videoPlayer = document.getElementById('videoPlayer');
    if (videoPlayer.src && videoPlayer.src.startsWith('blob:')) {
        URL.revokeObjectURL(videoPlayer.src);
    }
    
    // Create new video URL and set it
    const url = URL.createObjectURL(file);
    videoPlayer.src = url;
    
    // Show video preview
    document.getElementById('videoPreview').style.display = 'block';
    
    // Remove previous event listeners to avoid duplicates
    videoPlayer.removeEventListener('loadedmetadata', updateVideoMetadata);
    
    // Add event listener for metadata
    videoPlayer.addEventListener('loadedmetadata', updateVideoMetadata);
    
    // Enable analyze button immediately (don't wait for metadata)
    document.getElementById('analyzeBtn').disabled = false;
    
    console.log('✅ File ready for analysis');
}

function updateVideoMetadata() {
    const videoPlayer = document.getElementById('videoPlayer');
    
    if (videoPlayer.duration && !isNaN(videoPlayer.duration)) {
        document.getElementById('fileDuration').textContent = formatDuration(videoPlayer.duration);
    } else {
        document.getElementById('fileDuration').textContent = 'Loading...';
    }
    
    if (videoPlayer.videoWidth && videoPlayer.videoHeight) {
        document.getElementById('fileResolution').textContent = `${videoPlayer.videoWidth}×${videoPlayer.videoHeight}`;
    } else {
        document.getElementById('fileResolution').textContent = 'Loading...';
    }
}

       async function analyzeVideo() {
    if (!selectedFile) {
        alert('Please select a video file first.');
        return;
    }

    const analyzeBtn = document.getElementById('analyzeBtn');
    const resultDiv = document.getElementById('result');
    const progressBar = document.querySelector('.progress');
    
    // Update UI for analysis
    analyzeBtn.disabled = true;
    analyzeBtn.innerHTML = '🔬 Analyzing with AI...';
    analyzeBtn.classList.add('analyzing-glow');
    
    resultDiv.innerHTML = `
        <div class="result-card analyzing-glow">
            <h3>🔬 Advanced AI Analysis in Progress...</h3>
            <p>Running cutting-edge detection algorithms:</p>
            <div style="margin: 15px 0;">
                <div class="analysis-badge badge-active">Facial Analysis</div>
                <div class="analysis-badge badge-active">Lighting Detection</div>
                <div class="analysis-badge badge-active">Noise Analysis</div>
                <div class="analysis-badge badge-active">Artifact Detection</div>
                <div class="analysis-badge badge-active">Temporal Analysis</div>
                <div class="analysis-badge badge-active">Face Swap Detection</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p><small>This may take 10-30 seconds for comprehensive analysis...</small></p>
        </div>
    `;
    
    // Simulate progress
    // Simulate progress - Add null check
let progress = 0;
const progressInterval = setInterval(() => {
    progress += Math.random() * 15;
    if (progress > 90) progress = 90;
    const progressElement = document.getElementById('progressFill');
    if (progressElement) {
        progressElement.style.width = progress + '%';
    }
}, 500);

    const formData = new FormData();
    formData.append('video', selectedFile);

    try {
        const response = await fetch('https://ai-video-detector.up.railway.app/analyze', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();
        
        // Complete progress
        clearInterval(progressInterval);
        document.getElementById('progressFill').style.width = '100%';
        
        setTimeout(() => {
            displayResults(data);
            loadStats();
            loadHistory();
        }, 500);

    } catch (error) {
        console.error('Analysis error:', error);
        resultDiv.innerHTML = `
            <div class="result-card error-card">
                <h3>❌ Analysis Failed</h3>
                <p>Error: ${error.message}</p>
            </div>
        `;
    } finally {
        // Reset button
        setTimeout(() => {
            analyzeBtn.disabled = false;
            analyzeBtn.innerHTML = '🔍 Analyze Video';
            analyzeBtn.classList.remove('analyzing-glow');
        }, 1000);
    }
}
        function showResults(data) {
            const results = data.results;
            const performance = data.performance || {};
            
            document.getElementById('loadingDiv').style.display = 'none'
            document.getElementById('results').style.display = 'block';
            
            // Update verdict display
            let verdictText, verdictColor;
            if (results.ai_probability > 70) {
                verdictText = '⚠️ Likely AI Generated';
                verdictColor = '#dc3545';
            } else if (results.human_probability > 70) {
                verdictText = '✅ Likely Human Made';  
                verdictColor = '#28a745';
            } else {
                verdictText = '🤔 Uncertain Result';
                verdictColor = '#ffc107';
            }
            
            const verdictDisplay = document.getElementById('verdictDisplay');
            verdictDisplay.textContent = verdictText;
            verdictDisplay.style.color = verdictColor;
            
            document.getElementById('confidenceDisplay').textContent = 
                `${results.confidence.toUpperCase()} CONFIDENCE`;
            
            // Update probability bars
            setTimeout(() => {
                document.getElementById('aiBar').style.width = results.ai_probability + '%';
                document.getElementById('humanBar').style.width = results.human_probability + '%';
            }, 500);
            
            document.getElementById('aiPercentage').textContent = results.ai_probability.toFixed(1) + '%';
            document.getElementById('humanPercentage').textContent = results.human_probability.toFixed(1) + '%';
            
            // Update performance info
            document.getElementById('analysisTime').textContent = 
                performance.analysis_time ? performance.analysis_time + 's' : '-';
            document.getElementById('analysisType').textContent = 
                results.analysis_type || 'Basic';
            document.getElementById('databaseId').textContent = 
                data.database_id || '-';
            document.getElementById('gpuStatus').textContent = 
                performance.system_info?.gpu_available ? '✅ Available' : '❌ Not Available';
            
            // Update overview content
            updateOverviewContent(results, data);
            
            // Update detailed analysis if available
            if (data.detailed_analysis && data.detailed_analysis.components) {
                updateComponentScores(data.detailed_analysis.components);
            }
            
            document.getElementById('analyzeBtn').disabled = false;
        }

        function updateOverviewContent(results, data) {
            const overviewContent = document.getElementById('overviewContent');
            
            let riskLevel = 'Low';
            let riskColor = '#28a745';
            
            if (results.ai_probability > 70) {
                riskLevel = 'High';
                riskColor = '#dc3545';
            } else if (results.ai_probability > 40) {
                riskLevel = 'Medium';
                riskColor = '#ffc107';
            }
            
            overviewContent.innerHTML = `
                <div class="component-score">
                    <span class="component-name">Risk Level</span>
                    <span class="component-value" style="color: ${riskColor};">${riskLevel}</span>
                </div>
                <div class="component-score">
                    <span class="component-name">Detection Method</span>
                    <span class="component-value">${results.analysis_type || 'Basic'}</span>
                </div>
                <div class="component-score">
                    <span class="component-name">Confidence Score</span>
                    <span class="component-value">${results.confidence.toUpperCase()}</span>
                </div>
                <div class="component-score">
                    <span class="component-name">Video Duration</span>
                    <span class="component-value">${data.video_info ? data.video_info.duration.toFixed(1) + 's' : '-'}</span>
                </div>
            `;
        }

        function updateComponentScores(components) {
            const componentScores = document.getElementById('componentScores');
            
            let html = '';
            for (const [name, score] of Object.entries(components)) {
                const displayName = name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                html += `
                    <div class="component-score">
                        <span class="component-name">${displayName}</span>
                        <span class="component-value">${score.toFixed(1)}%</span>
                    </div>
                `;
            }
            
            componentScores.innerHTML = html || '<p>No detailed component data available.</p>';
        }

       async function loadStats() {
    try {
        console.log('Loading stats...');
        const response = await fetch('https://ai-video-detector.up.railway.app/stats');
        const data = await response.json();
        
        console.log('Stats data:', data);
        
        // Update the stats display
        document.getElementById('totalVideos').textContent = data.total_videos || 0;
        document.getElementById('aiDetected').textContent = data.total_ai_detected || 0;
        document.getElementById('humanDetected').textContent = data.total_human_detected || 0;
        document.getElementById('avgTime').textContent = data.avg_confidence ? data.avg_confidence + '%' : '-';
        
    } catch (error) {
        console.error('Failed to load stats:', error);
        // Set default values on error
        document.getElementById('totalVideos').textContent = '0';
        document.getElementById('aiDetected').textContent = '0';
        document.getElementById('humanDetected').textContent = '0';
        document.getElementById('avgTime').textContent = '-';
    }
}

        async function loadHistory() {
    try {
        console.log('Loading history...');
        const response = await fetch('https://ai-video-detector.up.railway.app/history');
        const data = await response.json();
        
        console.log('History data:', data);
        
        const historyList = document.getElementById('historyList');
        
        if (data && data.length > 0) {
            historyList.innerHTML = data.map(item => `
                <div class="history-item">
                    <div class="history-filename">${item.filename || 'Unknown file'}</div>
                    <div class="history-details">
                        <span>${item.is_ai ? '🤖 AI' : '👤 Human'} (${item.ai_probability}%)</span>
                        <span>${new Date(item.timestamp).toLocaleDateString()}</span>
                    </div>
                </div>
            `).join('');
        } else {
            historyList.innerHTML = '<p style="text-align: center; color: #666; margin: 20px 0;">No analysis history yet. Upload a video to get started!</p>';
        }
        
    } catch (error) {
        console.error('Failed to load history:', error);
        document.getElementById('historyList').innerHTML = '<p style="text-align: center; color: #666; margin: 20px 0;">Failed to load history.</p>';
    }
}

        function getVerdictEmoji(verdict) {
            switch(verdict) {
                case 'ai_generated': return '🤖';
                case 'human_made': return '👤';
                default: return '🤔';
            }
        }

        async function viewHistoryItem(analysisId) {
            try {
                const response = await fetch(`https://ai-video-detector.up.railway.app/analysis/${analysisId}`);
                const data = await response.json();
                
                if (data.success) {
                    // Show detailed history item info
                    const analysis = data.analysis;
                    alert(`Analysis Details:\n\nFile: ${analysis.filename}\nVerdict: ${analysis.results.verdict}\nConfidence: ${analysis.results.confidence}\nAI Probability: ${analysis.results.ai_probability.toFixed(1)}%\nProcessing Time: ${analysis.processing_time.toFixed(2)}s`);
                }
            } catch (error) {
                console.error('Failed to load analysis details:', error);
            }
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        // Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl + U = Upload file
    if (e.ctrlKey && e.key === 'u') {
        e.preventDefault();
        document.getElementById('fileInput').click();
    }
    
    // Ctrl + Enter = Analyze video (if file selected)
    if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        if (selectedFile && !document.getElementById('analyzeBtn').disabled) {
            analyzeVideo();
        }
    }
    
    // F5 = Refresh stats
    if (e.key === 'F5' && e.ctrlKey) {
        e.preventDefault();
        loadStats();
        loadHistory();
    }
});
function displayResults(data) {
    const resultDiv = document.getElementById('result');
    
    if (data.error) {
        resultDiv.innerHTML = `
            <div class="result-card error-card">
                <h3>❌ Analysis Error</h3>
                <p>${data.error}</p>
            </div>
        `;
        return;
    }

    const aiProb = data.ai_probability || 0;
    const confidence = data.confidence || 0;
    const classification = data.classification || 'Unknown';
    
    // Determine colors and status
    let statusColor, statusIcon, statusText;
    if (aiProb > 70) {
        statusColor = '#ff6b6b';
        statusIcon = '🤖';
        statusText = 'AI-Generated';
    } else if (aiProb > 40) {
        statusColor = '#ffd93d';
        statusIcon = '❓';
        statusText = 'Uncertain';
    } else {
        statusColor = '#6bcf7f';
        statusIcon = '👤';
        statusText = 'Likely Human';
    }

    // Component scores
    const detailedScores = data.detailed_scores || {};
    
    resultDiv.innerHTML = `
        <div class="result-card" style="border-left: 4px solid ${statusColor}">
            <h2 style="color: ${statusColor}; margin-bottom: 20px;">
                ${statusIcon} ${statusText}
            </h2>
            
            <!-- Main Results -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <div class="stat-card">
                    <div class="stat-number" style="color: ${statusColor}">${aiProb}%</div>
                    <div class="stat-label">AI Probability</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #00d4ff">${confidence}%</div>
                    <div class="stat-label">Confidence Score</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${confidence}%"></div>
                    </div>
                </div>
            </div>

            <!-- Advanced Component Scores -->
            <h3 style="color: #00d4ff; margin-bottom: 15px;">🔬 Advanced Analysis Components</h3>
            <div class="component-scores">
                <div class="component-card">
                    <div class="component-title">
                        💡 Lighting Analysis
                    </div>
                    <div class="component-score" style="color: ${detailedScores.lighting_analysis > 60 ? '#ff6b6b' : '#6bcf7f'}">
                        ${(detailedScores.lighting_analysis || 0).toFixed(1)}%
                    </div>
                    <div class="component-description">
                        Analyzes lighting consistency, shadows, and brightness patterns across frames
                    </div>
                </div>
                
                <div class="component-card">
                    <div class="component-title">
                        🔊 Noise Pattern Analysis
                    </div>
                    <div class="component-score" style="color: ${detailedScores.noise_analysis > 60 ? '#ff6b6b' : '#6bcf7f'}">
                        ${(detailedScores.noise_analysis || 0).toFixed(1)}%
                    </div>
                    <div class="component-description">
                        Detects unnatural noise patterns and digital compression artifacts
                    </div>
                </div>
                
                <div class="component-card">
                    <div class="component-title">
                        🎨 Artifact Detection
                    </div>
                    <div class="component-score" style="color: ${detailedScores.artifact_detection > 60 ? '#ff6b6b' : '#6bcf7f'}">
                        ${(detailedScores.artifact_detection || 0).toFixed(1)}%
                    </div>
                    <div class="component-description">
                        Identifies generative model artifacts like checkerboard patterns and grid anomalies
                    </div>
                </div>
                
                <div class="component-card">
                    <div class="component-title">
                        ⏱️ Temporal Analysis
                    </div>
                    <div class="component-score" style="color: ${detailedScores.temporal_analysis > 60 ? '#ff6b6b' : '#6bcf7f'}">
                        ${(detailedScores.temporal_analysis || 0).toFixed(1)}%
                    </div>
                    <div class="component-description">
                        Examines frame-to-frame consistency and motion patterns
                    </div>
                </div>
                
                <div class="component-card">
                    <div class="component-title">
                        👤 Face Swap Detection
                    </div>
                    <div class="component-score" style="color: ${detailedScores.face_swap_detection > 60 ? '#ff6b6b' : '#6bcf7f'}">
                        ${(detailedScores.face_swap_detection || 0).toFixed(1)}%
                    </div>
                    <div class="component-description">
                        Detects face swapping artifacts and boundary inconsistencies
                    </div>
                </div>
            </div>

            <!-- Technical Analysis Details -->
            <div class="analysis-details">
                <h3 style="color: #00d4ff; margin-bottom: 15px;">📊 Analysis Details</h3>
                
                <div class="detail-row">
                    <span class="detail-label">Frames Analyzed:</span>
                    <span class="detail-value">${data.frames_analyzed || 0}</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">Total Frames:</span>
                    <span class="detail-value">${data.total_frames || 0}</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">Analysis Time:</span>
                    <span class="detail-value">${data.analysis_time || 0}s</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">Classification:</span>
                    <span class="detail-value">${classification}</span>
                </div>

                <!-- Analysis Components Used -->
                <div style="margin-top: 15px;">
                    <div class="detail-label" style="margin-bottom: 8px;">Analysis Components:</div>
                    <div>
                        ${Object.entries(data.components_used || {}).map(([key, value]) => 
                            `<span class="analysis-badge ${value ? 'badge-active' : 'badge-inactive'}">
                                ${key.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                            </span>`
                        ).join('')}
                    </div>
                </div>
            </div>

            <!-- Advanced Metrics -->
            <div class="advanced-metrics">
                <div class="metric-item">
                    <div class="metric-value">${((data.frames_analyzed || 0) / (data.total_frames || 1) * 100).toFixed(1)}%</div>
                    <div class="metric-label">Coverage</div>
                </div>
                
                <div class="metric-item">
                    <div class="metric-value">${data.analysis_time ? (data.frames_analyzed / data.analysis_time).toFixed(1) : 0}</div>
                    <div class="metric-label">Frames/sec</div>
                </div>
                
                <div class="metric-item">
                    <div class="metric-value">${Object.values(data.components_used || {}).filter(Boolean).length}</div>
                    <div class="metric-label">Components</div>
                </div>
                
                <div class="metric-item">
                    <div class="metric-value">${confidence > 80 ? 'HIGH' : confidence > 60 ? 'MED' : 'LOW'}</div>
                    <div class="metric-label">Reliability</div>
                </div>
            </div>
        </div>
    `;
    
    // Add smooth animations
    setTimeout(() => {
        document.querySelectorAll('.component-card').forEach((card, index) => {
            setTimeout(() => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'all 0.5s ease';
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 50);
            }, index * 100);
        });
    }, 100);
}
    </script>
</body>
</html>
